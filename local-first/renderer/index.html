<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Kairo AI Browser - Local-First Edition" />
    <title>Kairo AI Browser</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/framer-motion@10/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/lucide-react@0.294.0/dist/esm/icons/search.js" type="module"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow: hidden;
      }

      .title-bar {
        -webkit-app-region: drag;
        -webkit-user-select: none;
        user-select: none;
      }

      .title-bar button {
        -webkit-app-region: no-drag;
      }

      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #374151;
      }

      ::-webkit-scrollbar-thumb {
        background: #6B7280;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #9CA3AF;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <script type="text/babel">
      const { useState, useEffect, useCallback } = React;
      const { motion, AnimatePresence } = window.FramerMotion;

      // Icon components (simplified)
      const IconComponent = ({ name, className = "w-5 h-5" }) => {
        const icons = {
          'search': '🔍',
          'bot': '🤖',
          'globe': '🌐',
          'settings': '⚙️',
          'minimize': '−',
          'maximize': '□',
          'close': '×',
          'home': '🏠',
          'arrow-left': '←',
          'arrow-right': '→',
          'rotate-ccw': '↻',
          'star': '⭐'
        };
        
        return React.createElement('span', {
          className: `inline-block ${className}`,
          style: { fontSize: '16px' }
        }, icons[name] || '?');
      };

      function App() {
        const [isLocalFirst, setIsLocalFirst] = useState(false);
        const [currentUrl, setCurrentUrl] = useState('');
        const [pageTitle, setPageTitle] = useState('Kairo AI Browser');
        const [aiChatOpen, setAiChatOpen] = useState(false);
        const [aiMessages, setAiMessages] = useState([]);
        const [aiInput, setAiInput] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [systemInfo, setSystemInfo] = useState(null);

        useEffect(() => {
          const initializeApp = async () => {
            try {
              if (window.kairoAPI && window.kairoAPI.system) {
                const info = await window.kairoAPI.system.getInfo();
                setSystemInfo(info.system);
                setIsLocalFirst(true);
                console.log('🚀 Local-First Mode Activated');
              } else {
                console.log('🌐 Web fallback mode');
              }
            } catch (error) {
              console.error('Initialization error:', error);
            }
          };
          initializeApp();
        }, []);

        const navigateToUrl = useCallback(async (url) => {
          if (!url) return;
          
          if (!url.startsWith('http://') && !url.startsWith('https://')) {
            url = 'https://' + url;
          }

          setIsLoading(true);
          try {
            if (isLocalFirst && window.kairoAPI) {
              const result = await window.kairoAPI.browser.navigate(url);
              if (result.success) {
                setCurrentUrl(result.url);
                setPageTitle(result.title);
              }
            } else {
              setCurrentUrl(url);
              setPageTitle('Loading...');
            }
          } catch (error) {
            console.error('Navigation error:', error);
          } finally {
            setIsLoading(false);
          }
        }, [isLocalFirst]);

        const handleAIQuery = useCallback(async (query) => {
          if (!query.trim()) return;

          const userMessage = { role: 'user', content: query, timestamp: new Date() };
          setAiMessages(prev => [...prev, userMessage]);
          setAiInput('');
          setIsLoading(true);

          try {
            if (isLocalFirst && window.kairoAPI) {
              const result = await window.kairoAPI.ai.query(query, {
                currentUrl,
                pageTitle
              });
              
              if (result.success) {
                const aiMessage = { 
                  role: 'assistant', 
                  content: result.response.explanation,
                  timestamp: new Date() 
                };
                setAiMessages(prev => [...prev, aiMessage]);

                if (result.response.commands && result.response.commands.length > 0) {
                  for (const command of result.response.commands) {
                    try {
                      await window.kairoAPI.browser.execute(command.type, command.params);
                    } catch (error) {
                      console.error('Command execution error:', error);
                    }
                  }
                }
              }
            } else {
              const aiMessage = { 
                role: 'assistant', 
                content: `I understand you want to: "${query}". In local-first mode, I can execute this directly on websites.`,
                timestamp: new Date() 
              };
              setAiMessages(prev => [...prev, aiMessage]);
            }
          } catch (error) {
            console.error('AI query error:', error);
          } finally {
            setIsLoading(false);
          }
        }, [isLocalFirst, currentUrl, pageTitle]);

        const quickNavigate = (site) => {
          const urls = {
            youtube: 'https://youtube.com',
            google: 'https://google.com',
            github: 'https://github.com',
            netflix: 'https://netflix.com'
          };
          navigateToUrl(urls[site]);
        };

        return React.createElement('div', {
          className: 'min-h-screen bg-gray-900 text-white flex flex-col'
        }, [
          // Title Bar
          isLocalFirst && React.createElement('div', {
            key: 'titlebar',
            className: 'title-bar bg-gray-800 px-4 py-2 flex items-center justify-between'
          }, [
            React.createElement('div', {
              key: 'title',
              className: 'flex items-center space-x-2'
            }, [
              React.createElement(IconComponent, { key: 'icon', name: 'globe', className: 'w-5 h-5 text-blue-400' }),
              React.createElement('span', { key: 'text', className: 'font-semibold' }, 'Kairo AI Browser'),
              React.createElement('span', { key: 'badge', className: 'text-xs text-green-400 bg-green-400/20 px-2 py-1 rounded' }, 'LOCAL-FIRST')
            ]),
            React.createElement('div', {
              key: 'controls',
              className: 'flex items-center space-x-1'
            }, [
              React.createElement('button', {
                key: 'min',
                onClick: () => window.kairoAPI?.window.minimize(),
                className: 'p-2 hover:bg-gray-700 rounded'
              }, React.createElement(IconComponent, { name: 'minimize', className: 'w-4 h-4' })),
              React.createElement('button', {
                key: 'max',
                onClick: () => window.kairoAPI?.window.maximize(),
                className: 'p-2 hover:bg-gray-700 rounded'
              }, React.createElement(IconComponent, { name: 'maximize', className: 'w-4 h-4' })),
              React.createElement('button', {
                key: 'close',
                onClick: () => window.kairoAPI?.window.close(),
                className: 'p-2 hover:bg-red-600 rounded'
              }, React.createElement(IconComponent, { name: 'close', className: 'w-4 h-4' }))
            ])
          ]),

          // Navigation Bar
          React.createElement('div', {
            key: 'navbar',
            className: 'bg-gray-800 px-4 py-3 border-b border-gray-700'
          }, [
            React.createElement('div', {
              key: 'nav-content',
              className: 'flex items-center space-x-4'
            }, [
              React.createElement('div', {
                key: 'url-section',
                className: 'flex-1 flex items-center'
              }, [
                React.createElement('input', {
                  key: 'url-input',
                  type: 'text',
                  value: currentUrl,
                  onChange: (e) => setCurrentUrl(e.target.value),
                  onKeyPress: (e) => e.key === 'Enter' && navigateToUrl(currentUrl),
                  placeholder: 'Enter URL or search...',
                  className: 'flex-1 bg-gray-900 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none'
                }),
                React.createElement('button', {
                  key: 'go-btn',
                  onClick: () => navigateToUrl(currentUrl),
                  className: 'ml-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors',
                  disabled: isLoading
                }, isLoading ? '...' : 'Go')
              ]),
              React.createElement('button', {
                key: 'ai-btn',
                onClick: () => setAiChatOpen(true),
                className: 'p-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors',
                title: 'Open AI Assistant'
              }, React.createElement(IconComponent, { name: 'bot' }))
            ]),
            React.createElement('div', {
              key: 'quick-nav',
              className: 'flex items-center space-x-2 mt-3'
            }, [
              React.createElement('span', { key: 'label', className: 'text-sm text-gray-400' }, 'Quick Access:'),
              React.createElement('button', {
                key: 'youtube',
                onClick: () => quickNavigate('youtube'),
                className: 'px-3 py-1 bg-red-600/20 text-red-400 rounded hover:bg-red-600/30 transition-colors'
              }, 'YouTube'),
              React.createElement('button', {
                key: 'google',
                onClick: () => quickNavigate('google'),
                className: 'px-3 py-1 bg-blue-600/20 text-blue-400 rounded hover:bg-blue-600/30 transition-colors'
              }, 'Google'),
              React.createElement('button', {
                key: 'github',
                onClick: () => quickNavigate('github'),
                className: 'px-3 py-1 bg-gray-600/20 text-gray-400 rounded hover:bg-gray-600/30 transition-colors'
              }, 'GitHub'),
              React.createElement('button', {
                key: 'netflix',
                onClick: () => quickNavigate('netflix'),
                className: 'px-3 py-1 bg-red-600/20 text-red-400 rounded hover:bg-red-600/30 transition-colors'
              }, 'Netflix')
            ])
          ]),

          // Main Content
          React.createElement('div', {
            key: 'main',
            className: 'flex-1 bg-white'
          }, React.createElement('div', {
            className: 'h-full flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100'
          }, React.createElement('div', {
            className: 'text-center p-8'
          }, [
            React.createElement(IconComponent, { key: 'icon', name: 'globe', className: 'w-16 h-16 text-blue-600 mx-auto mb-4' }),
            React.createElement('h2', { key: 'title', className: 'text-2xl font-bold text-gray-800 mb-2' }, 'Embedded Browser Ready'),
            React.createElement('p', { key: 'desc', className: 'text-gray-600 mb-4' }, [
              'Native Chromium browser with full website access.',
              React.createElement('br', { key: 'br' }),
              'No proxy restrictions - YouTube, Netflix, banking sites all work perfectly.'
            ]),
            React.createElement('p', { key: 'url', className: 'text-sm text-gray-500' }, `Current URL: ${currentUrl || 'None'}`),
            systemInfo && React.createElement('div', { key: 'sysinfo', className: 'mt-4 text-xs text-gray-400' }, [
              React.createElement('p', { key: 'p1' }, `Platform: ${systemInfo.platform} | Memory: ${systemInfo.memory}GB`),
              React.createElement('p', { key: 'p2' }, `Electron: ${systemInfo.electron} | Chrome: ${systemInfo.chrome}`)
            ])
          ]))),

          // AI Chat Sidebar
          aiChatOpen && React.createElement('div', {
            key: 'ai-chat',
            className: 'fixed right-0 top-0 h-full w-96 bg-gray-800 border-l border-gray-700 flex flex-col'
          }, [
            React.createElement('div', {
              key: 'chat-header',
              className: 'p-4 border-b border-gray-700 flex items-center justify-between'
            }, [
              React.createElement('div', { key: 'header-left', className: 'flex items-center space-x-2' }, [
                React.createElement(IconComponent, { key: 'bot-icon', name: 'bot', className: 'w-6 h-6 text-green-400' }),
                React.createElement('span', { key: 'title', className: 'font-semibold' }, 'AI Assistant'),
                isLocalFirst && React.createElement('span', { key: 'badge', className: 'text-xs text-green-400' }, 'LOCAL')
              ]),
              React.createElement('button', {
                key: 'close',
                onClick: () => setAiChatOpen(false),
                className: 'p-1 hover:bg-gray-700 rounded'
              }, React.createElement(IconComponent, { name: 'close' }))
            ]),
            React.createElement('div', {
              key: 'messages',
              className: 'flex-1 overflow-y-auto p-4 space-y-4'
            }, aiMessages.length === 0 ? 
              React.createElement('div', { className: 'text-center text-gray-400 py-8' }, [
                React.createElement(IconComponent, { key: 'icon', name: 'bot', className: 'w-12 h-12 mx-auto mb-4 opacity-50' }),
                React.createElement('p', { key: 'text' }, 'Ask me to help you browse the web!'),
                React.createElement('div', { key: 'examples', className: 'mt-4 space-y-2 text-sm' }, [
                  React.createElement('p', { key: 'try', className: 'text-green-400' }, 'Try saying:'),
                  React.createElement('p', { key: 'ex1' }, '"Open YouTube and play AI tutorials"'),
                  React.createElement('p', { key: 'ex2' }, '"Navigate to Google and search for weather"'),
                  React.createElement('p', { key: 'ex3' }, '"Take me to Netflix"')
                ])
              ]) :
              aiMessages.map((message, index) => 
                React.createElement('div', {
                  key: index,
                  className: message.role === 'user' ? 'ml-8' : 'mr-8'
                }, React.createElement('div', {
                  className: `p-3 rounded-lg ${message.role === 'user' ? 'bg-blue-600 text-white ml-auto' : 'bg-gray-700 text-gray-100'}`
                }, React.createElement('p', { className: 'text-sm' }, message.content)))
              )
            ),
            React.createElement('div', {
              key: 'input',
              className: 'p-4 border-t border-gray-700'
            }, React.createElement('div', { className: 'flex space-x-2' }, [
              React.createElement('input', {
                key: 'ai-input',
                type: 'text',
                value: aiInput,
                onChange: (e) => setAiInput(e.target.value),
                onKeyPress: (e) => e.key === 'Enter' && handleAIQuery(aiInput),
                placeholder: 'Ask me to do something...',
                className: 'flex-1 bg-gray-900 text-white px-3 py-2 rounded border border-gray-600 focus:border-green-500 focus:outline-none',
                disabled: isLoading
              }),
              React.createElement('button', {
                key: 'send',
                onClick: () => handleAIQuery(aiInput),
                disabled: isLoading || !aiInput.trim(),
                className: 'px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded transition-colors'
              }, 'Send')
            ]))
          ])
        ]);
      }

      ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </body>
</html>